# Vue2 到 Vue3 迁移指南

## 当前项目状态

**✅ 已完成：**
- Vue3前端代码在 `frontend/` 目录下，已经开发完成
- 已经完整对接后端Go API（HTTP REST + WebSocket）
- 支持所有原有功能：消息发送、文件上传、房间管理、认证等

**❌ 问题：**
- 原来的Vue2编译文件还在 `lib/static/` 目录下
- 后端默认提供的是Vue2的静态文件，不是新的Vue3版本

## 迁移方案选择

### 方案1：并行测试（推荐第一步）
**保留Vue2，单独测试Vue3**

```powershell
# 1. 启动Vue3开发服务器
cd frontend
npm install
npm run dev

# 2. 在另一个终端启动后端
go run main.go
```

**访问地址：**
- Vue3前端：http://localhost:3000
- 后端API：http://localhost:9501
- 原有Vue2：通过后端访问（不变）

**优点：**
- 零风险，不影响现有服务
- 可以并行对比测试
- 随时可以回滚

### 方案2：完全替换（测试通过后）
**用Vue3完全替换Vue2**

需要修改后端代码，重新编译Vue3并替换静态文件。

## Vue3测试清单

### 基础功能测试
- [ ] 前端页面正常加载，无报错
- [ ] WebSocket连接成功，状态显示正常
- [ ] 能发送文本消息并实时显示
- [ ] 能上传文件（小于256MB）并正确显示
- [ ] 消息撤销功能正常
- [ ] 清空消息功能正常

### 房间功能测试
- [ ] 能切换房间
- [ ] 房间列表显示正确
- [ ] 不同房间消息隔离
- [ ] 房间状态实时更新

### 高级功能测试
- [ ] 文件缩略图生成（图片文件）
- [ ] 认证功能（如启用）
- [ ] PWA功能（移动端）
- [ ] 响应式布局（移动端适配）

## 实施步骤

### 第一步：并行测试
1. 按方案1启动Vue3开发环境
2. 逐项完成功能测试清单
3. 记录问题和bug
4. 修复问题直到全部通过

### 第二步：生产部署（测试通过后）
1. 编译Vue3生产版本
2. 备份原有Vue2静态文件
3. 替换后端静态文件服务
4. 验证生产环境功能

## 命令参考

### Vue3开发环境
```powershell
cd frontend
npm install          # 安装依赖
npm run dev          # 启动开发服务器
npm run build        # 编译生产版本
npm run preview      # 预览生产版本
```

### 后端服务
```powershell
go run main.go       # 开发模式运行
go build             # 编译二进制
```

### 测试命令
```powershell
cd frontend
npm run type-check   # TypeScript类型检查
npm run lint         # 代码 lint 检查
```

## 注意事项

1. **端口冲突**：Vue3开发服务器默认3000端口，确保未被占用
2. **API地址**：开发环境通过Vite代理，生产环境需要配置正确API地址
3. **WebSocket连接**：确保后端WebSocket服务正常运行
4. **文件上传限制**：默认256MB，可在后端配置
5. **认证配置**：如启用认证，需要正确配置token

## 故障排除

### Vue3页面空白
- 检查浏览器控制台错误信息
- 确认API地址配置正确
- 检查网络请求是否成功

### WebSocket连接失败
- 确认后端WebSocket服务启动
- 检查防火墙和端口设置
- 查看浏览器网络面板

### 文件上传失败
- 检查文件大小限制
- 确认后端存储目录权限
- 查看后端日志信息

## 下一步行动

1. **立即执行**：按方案1启动Vue3测试环境
2. **完成功能测试**：逐项检查测试清单
3. **记录问题**：发现问题及时修复
4. **决定迁移**：测试通过后考虑方案2

**重要提醒：先测试，再替换！确保Vue3完全正常工作后再考虑替换生产环境。**
